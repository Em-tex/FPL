<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Melding om grensekryssende droneflyging</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
</head>
<body>

    <header>
        <div class="header-container">
            <div class="logo-group">
                <a href="https://www.luftfartstilsynet.no/droner/" id="logoLink" target="_blank" class="logo-link">
                    <img src="logo.png" alt="Luftfartstilsynet Logo" class="logo">
                </a>
                <h1 data-i18n="mainHeader">Melding om grensekryssende droneflyging</h1>
            </div>

            <button id="langToggle" class="btn-lang no-print" onclick="toggleLanguage()">Switch to English</button>
        </div>
    </header>

    <div class="container">
        
        <div class="intro-block no-print">
            <p data-i18n="introBlock" style="margin: 0; white-space: pre-line;">Skjema for informasjon...</p>
        </div>

        <form id="flightForm">
            
            <section class="card form-section">
                <h2 data-i18n="sect1Header">1. Operatør og Tillatelser</h2>
                
                <div class="grid-2">
                    <div class="form-group full-width">
                        <label for="operatorName" data-i18n="lblOperatorName">Operatørnavn (Selskap/Privat):</label>
                        <input type="text" id="operatorName" name="operatorName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="operatorEmail" data-i18n="lblOperatorEmail">Operatør E-post:</label>
                        <input type="email" id="operatorEmail" name="operatorEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="operatorPhone" data-i18n="lblOperatorPhone">Operatør Telefon:</label>
                        <input type="tel" id="operatorPhone" name="operatorPhone" required>
                    </div>

                    <div class="form-group">
                        <label for="pilotName" data-i18n="lblPilotName">Navn på Pilot:</label>
                        <input type="text" id="pilotName" name="pilotName" required>
                    </div>
                    <div class="form-group">
                        <label for="pilotPhone" data-i18n="lblPilotPhone">Pilot Telefon (tilgjengelig under flyging):</label>
                        <input type="tel" id="pilotPhone" name="pilotPhone" required>
                    </div>
                </div>

                <div class="sub-section">
                    <h3 data-i18n="subHeaderAuth">Tillatelser / Autorisasjoner</h3>
                    
                    <div class="checkbox-group full-width" style="margin-bottom: 15px;">
                        <label>
                            <input type="checkbox" id="isStateAircraft" name="isStateAircraft">
                            <span data-i18n="chkStateAircraft">Militær / Statsluftfart (Unntatt fra EASA-regler)</span>
                        </label>
                    </div>

                    <div id="civilAuthContainer" class="grid-2">
                        <div class="form-group">
                            <label for="oatNumber" data-i18n="lblOat">Kreves for operatører uten norsk OAT-nummer:</label>
                            <small class="help-text" data-i18n="helpOat">Fylles ut hvis du ikke har et norsk tildelt nummer (f.eks. utenlandske operatører).</small>
                            <input type="text" id="oatNumber" name="oatNumber" placeholder="F.eks. UAS-NO-..." >
                        </div>
                        
                        <div class="form-group">
                            <label for="cboNumber" data-i18n="lblCbo">CBO/CRB-nummer (Bekreftelse fra besøksland):</label>
                            <small class="help-text" data-i18n="helpCbo">Kreves for utenlandske operatører (også fra int. farvann).</small>
                            <input type="text" id="cboNumber" name="cboNumber" placeholder="F.eks. SWE-CBO-12345/001">
                            
                            <div style="margin-top: 8px;">
                                <label style="font-weight: normal; font-size: 0.9em; display: flex; align-items: center;">
                                    <input type="checkbox" id="isIntWaters" name="isIntWaters" style="width: auto; margin-right: 8px;">
                                    <span data-i18n="chkIntWaters">Passering fra internasjonalt farvann</span>
                                </label>
                            </div>
                        </div>
                    </div>
                 </div>
            </section>

            <section class="card form-section">
                <h2 data-i18n="sect2Header">2. Fartøy (Drone)</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="manufacturer" data-i18n="lblManufacturer">Produsent:</label>
                        <input type="text" id="manufacturer" name="manufacturer" required>
                    </div>
                    <div class="form-group">
                        <label for="model" data-i18n="lblModel">Modell:</label>
                        <input type="text" id="model" name="model" required>
                    </div>
                    
                    <div class="form-group">
                         <label for="mtom" data-i18n="lblMtom">MTOM (kg):</label>
                         <input type="number" step="0.1" id="mtom" name="mtom" placeholder="F.eks. 7.5">
                    </div>

                    <div class="form-group">
                        <label for="droneType" data-i18n="lblDroneType">Fartøytype:</label>
                        <select id="droneType" name="droneType">
                            <option value="Multirotor">Multirotor</option>
                            <option value="Fixed Wing" data-i18n="optFixedWing">Fixed Wing (Fly)</option>
                            <option value="Helicopter" data-i18n="optHelicopter">Helikopter (Single rotor)</option>
                            <option value="Airship" data-i18n="optAirship">Luftskip</option>
                            <option value="Balloon" data-i18n="optBalloon">Ballong</option>
                            <option value="Hybrid">Hybrid (VTOL)</option>
                            <option value="Other" data-i18n="optOther">Annet</option>
                        </select>
                        <div id="typeOtherContainer" class="hidden" style="margin-top: 5px;">
                            <label for="typeOtherText" data-i18n="lblTypeOtherDesc" style="font-weight: normal; font-size: 0.85em;">Beskriv:</label>
                            <input type="text" id="typeOtherText" name="typeOtherText">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="powerplant" data-i18n="lblPowerplant">Drivlinje / Powerplant:</label>
                        <select id="powerplant" name="powerplant">
                            <option value="Electric" data-i18n="optElectric">Elektrisk</option>
                            <option value="Piston" data-i18n="optPiston">Stempelmotor / Hybrid</option>
                            <option value="Turbine" data-i18n="optTurbine">Turbin / Jet</option>
                            <option value="None" data-i18n="optNone">Ingen (Glidefly/Ballong)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="color" data-i18n="lblColor">Farge / Kjennetegn:</label>
                        <input type="text" id="color" name="color" required>
                    </div>
                </div>

                <div class="form-group full-width" style="margin-top: 20px;">
                    <label class="label-heading" data-i18n="lblEc">Elektronisk Synlighet (Velg alle som gjelder):</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="ec" value="Mode S"> Mode S</label>
                        <label><input type="checkbox" name="ec" value="Mode S ES"> Mode S ES (ADS-B 1090)</label>
                        <label><input type="checkbox" name="ec" value="ADS-L 4 SRD 860"> ADS-L 4 SRD 860</label>
                        <label><input type="checkbox" name="ec" value="ADS-L 4 MOBILE"> ADS-L 4 MOBILE</label>
                        <label><input type="checkbox" name="ec" value="Remote ID"> Remote ID (WiFi/BT)</label>
                        <label><input type="checkbox" id="ecOtherCheck" name="ec" value="Annet"> <span data-i18n="lblOther">Annet</span></label>
                    </div>
                    <div id="ecOtherContainer" class="hidden">
                        <label for="ecOtherText" data-i18n="lblEcDesc">Beskriv annet utstyr:</label>
                        <input type="text" id="ecOtherText" name="ecOtherText">
                    </div>
                </div>
            </section>

            <section class="card form-section">
                <h2 data-i18n="sect3Header">3. Flyging og Rute</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="depPlace" data-i18n="lblDepPlace">Avgangssted:</label>
                        <input type="text" id="depPlace" name="depPlace" required>
                    </div>
                    <div class="form-group">
                        <label for="depTime" data-i18n="lblDepTime">Avgangstid (UTC/Lokal):</label>
                        <input type="datetime-local" id="depTime" name="depTime" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="speed" data-i18n="lblSpeed">Cruising Speed:</label>
                        <input type="text" id="speed" name="speed" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="endurance" data-i18n="lblEndurance">Endurance:</label>
                        <input type="text" id="endurance" name="endurance" placeholder="">
                    </div>
                    
                    <div class="form-group">
                        <label for="altitudeVal" data-i18n="lblAltitude">Planlagt Høyde (Maks):</label>
                        <div class="input-group">
                            <input type="number" id="altitudeVal" name="altitudeVal" placeholder="">
                            <select name="altitudeRef" id="altitudeRef">
                                <option value="ft AGL">ft AGL</option>
                                <option value="m AGL">m AGL</option>
                                <option value="ft AMSL">ft AMSL</option>
                                <option value="FL">Flight Level (FL)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="arrPlace" data-i18n="lblArrPlace">Landingssted:</label>
                        <input type="text" id="arrPlace" name="arrPlace" required>
                    </div>
                    <div class="form-group">
                        <label for="arrTime" data-i18n="lblArrTime">Landingstid (Estimert):</label>
                        <input type="datetime-local" id="arrTime" name="arrTime" required>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="borderPoint" data-i18n="lblBorderPoint">Sted for grensepassering (Navn/Koordinat):</label>
                        <input type="text" id="borderPoint" name="borderPoint" required>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label class="checkbox-single">
                        <input type="checkbox" id="radioContact" name="radioContact">
                        <strong data-i18n="lblRadio">Vil opprette radiokontakt med ATC</strong>
                    </label>
                </div>

                <div class="map-section">
                    <label class="label-heading" data-i18n="lblRouteMap">Ruteoversikt</label>
                    <p class="help-text" data-i18n="txtMapHelp">Tegn rute i kartet eller last opp KML/GPX-fil.</p>
                    
                    <div class="map-controls no-print">
                        <input type="file" id="fileUpload" accept=".kml,.gpx,.json,.geojson" class="file-input">
                        <button type="button" class="btn-small" onclick="clearMap()" data-i18n="btnMapClear">Slett kartdata</button>
                    </div>

                    <div id="map"></div>
                </div>
            </section>

            <div class="actions no-print">
                <button type="button" class="btn btn-secondary" onclick="exportJSON()" data-i18n="btnJson">Last ned Data (JSON)</button>
                <button type="button" class="btn btn-primary" onclick="printForm()" data-i18n="btnPdf">Last ned / Skriv ut (PDF)</button>
            </div>

            <div class="info-box form-section">
                <h3 data-i18n="infoBoxHeader">Innsending og Viktig Info</h3>
                <p data-i18n="infoSendTo">Når skjemaet er utfylt og PDF/JSON er lastet ned, sendes filene til:</p>
                <ul>
                    <li><strong>Luftfartstilsynet:</strong> postmottak@caa.no</li>
                    <li><strong>Toll / Forsvaret / Avinor:</strong> Sendes etter lokal avtale/behov.</li>
                </ul>
                <div class="disclaimer">
                    <strong data-i18n="disclaimerTitle">Merk:</strong>
                    <p id="footerDisclaimerText">
                        Dette skjemaet er en orientering...
                        <a href="https://registrering.sensor.nsm.cloudgis.no/?initialLang=en" target="_blank">NSM</a>.
                    </p>
                </div>
            </div>

        </form>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
    <script src="translations.js"></script>
    <script src="script.js"></script>
</body>
</html>